<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>file_1649576932358</title><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 .s1 { color: #1F2329; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 24pt; }
 .s2 { color: #666; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s3 { color: #999; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 .s4 { color: #1F2329; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 18pt; }
 .s5 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 .s6 { color: #C00; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s7 { color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s8 { color: black; font-family:Calibri, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s9 { color: #4A86E7; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s10 { color: #4A86E7; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; vertical-align: 3pt; }
 .s11 { color: #4A86E7; font-family:"Microsoft Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s12 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s13 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; vertical-align: -4pt; }
 .p, p { color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; margin:0pt; }
 .s14 { color: black; font-family:Calibri, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s15 { color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 .h2, h2 { color: #1F2329; font-family:"Palatino Linotype", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 h1 { color: #1F2329; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 .s17 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s18 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s19 { color: #1F2329; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s20 { color: #1F2329; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s21 { color: #1F2329; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s22 { color: #F90; font-family:"Trebuchet MS", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .h3 { color: #1F2329; font-family:"Palatino Linotype", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s24 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -3pt; }
 .s25 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8.5pt; vertical-align: -1pt; }
 .s26 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -3pt; }
 .s27 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s28 { color: black; font-family:"MS Gothic", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s29 { color: black; font-family:"Palatino Linotype", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 .s30 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s31 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s32 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -4pt; }
 .s33 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: underline; font-size: 9pt; }
 .s34 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: underline; font-size: 6.5pt; vertical-align: -2pt; }
 .s35 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 6.5pt; vertical-align: -2pt; }
 .s36 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt; }
 .s37 { color: black; font-family:"Segoe UI Symbol", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 15pt; }
 .a, a { color: #1154CC; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 13pt; }
 .s38 { color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; vertical-align: -1pt; }
 .s39 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -3pt; }
 .s40 { color: black; font-family:"Segoe UI Symbol", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 15.5pt; }
 .s41 { color: #1F2329; font-family:Calibri, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s42 { color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 .s43 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s44 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: underline; font-size: 9pt; vertical-align: 2pt; }
 .s46 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s47 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: 2pt; }
 .s48 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; vertical-align: -1pt; }
 .s49 { color: black; font-family:"MS Gothic", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -3pt; }
 .s50 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s51 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 .s52 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; vertical-align: -2pt; }
 li {display: block; }
 #l1 {padding-left: 0pt; }
 #l1> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l2 {padding-left: 0pt; }
 #l2> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l3 {padding-left: 0pt; }
 #l3> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l4 {padding-left: 0pt; }
 #l4> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l5 {padding-left: 0pt; }
 #l5> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l6 {padding-left: 0pt; }
 #l6> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l7 {padding-left: 0pt; }
 #l7> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l8 {padding-left: 0pt; }
 #l8> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l9 {padding-left: 0pt; }
 #l9> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l10 {padding-left: 0pt; }
 #l10> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l11 {padding-left: 0pt; }
 #l11> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l12 {padding-left: 0pt; }
 #l12> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l13 {padding-left: 0pt; }
 #l13> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l14 {padding-left: 0pt; }
 #l14> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l15 {padding-left: 0pt; }
 #l15> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l16 {padding-left: 0pt; }
 #l16> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l17 {padding-left: 0pt; }
 #l17> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l18 {padding-left: 0pt; }
 #l18> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l19 {padding-left: 0pt; }
 #l19> li>*:first-child:before {content: "● "; color: #1F2329; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l20 {padding-left: 0pt; }
 #l20> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l21 {padding-left: 0pt; }
 #l21> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l22 {padding-left: 0pt; }
 #l22> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l23 {padding-left: 0pt; }
 #l23> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l24 {padding-left: 0pt; }
 #l24> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l25 {padding-left: 0pt; }
 #l25> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l26 {padding-left: 0pt; }
 #l26> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l27 {padding-left: 0pt; }
 #l27> li>*:first-child:before {content: "> "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l28 {padding-left: 0pt; }
 #l28> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l29 {padding-left: 0pt; }
 #l29> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l30 {padding-left: 0pt; }
 #l30> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l31 {padding-left: 0pt; }
 #l31> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l32 {padding-left: 0pt; }
 #l32> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l33 {padding-left: 0pt; }
 #l33> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l34 {padding-left: 0pt; }
 #l34> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l35 {padding-left: 0pt; }
 #l35> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l36 {padding-left: 0pt; }
 #l36> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l37 {padding-left: 0pt; }
 #l37> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l38 {padding-left: 0pt; }
 #l38> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l39 {padding-left: 0pt; }
 #l39> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l40 {padding-left: 0pt; }
 #l40> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l41 {padding-left: 0pt; }
 #l41> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l42 {padding-left: 0pt; }
 #l42> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l43 {padding-left: 0pt; }
 #l43> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l44 {padding-left: 0pt; }
 #l44> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l45 {padding-left: 0pt; }
 #l45> li>*:first-child:before {content: "● "; color: #1F2329; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 #l46 {padding-left: 0pt; }
 #l46> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l47 {padding-left: 0pt; }
 #l47> li>*:first-child:before {content: "● "; color: #1F2329; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 #l48 {padding-left: 0pt; }
 #l48> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l49 {padding-left: 0pt; }
 #l49> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l50 {padding-left: 0pt; }
 #l50> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l51 {padding-left: 0pt; }
 #l51> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l52 {padding-left: 0pt; }
 #l52> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l53 {padding-left: 0pt; }
 #l53> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l54 {padding-left: 0pt; }
 #l54> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l55 {padding-left: 0pt; }
 #l55> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l56 {padding-left: 0pt; }
 #l56> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l57 {padding-left: 0pt; }
 #l57> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l58 {padding-left: 0pt; }
 #l58> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l59 {padding-left: 0pt; }
 #l59> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l60 {padding-left: 0pt; }
 #l60> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l61 {padding-left: 0pt; }
 #l61> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l62 {padding-left: 0pt; }
 #l62> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l63 {padding-left: 0pt; }
 #l63> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l64 {padding-left: 0pt; }
 #l64> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l65 {padding-left: 0pt; }
 #l65> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l66 {padding-left: 0pt; }
 #l66> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l67 {padding-left: 0pt; }
 #l67> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l68 {padding-left: 0pt; }
 #l68> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l69 {padding-left: 0pt; }
 #l69> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l70 {padding-left: 0pt; }
 #l70> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l71 {padding-left: 0pt; }
 #l71> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l72 {padding-left: 0pt; }
 #l72> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l73 {padding-left: 0pt; }
 #l73> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l74 {padding-left: 0pt; }
 #l74> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l75 {padding-left: 0pt; }
 #l75> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l76 {padding-left: 0pt; }
 #l76> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l77 {padding-left: 0pt; }
 #l77> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l78 {padding-left: 0pt; }
 #l78> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l79 {padding-left: 0pt; }
 #l79> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l80 {padding-left: 0pt; }
 #l80> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l81 {padding-left: 0pt; }
 #l81> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l82 {padding-left: 0pt; }
 #l82> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l83 {padding-left: 0pt; }
 #l83> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l84 {padding-left: 0pt; }
 #l84> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l85 {padding-left: 0pt; }
 #l85> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l86 {padding-left: 0pt; }
 #l86> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l87 {padding-left: 0pt; }
 #l87> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l88 {padding-left: 0pt;counter-reset: e1 1; }
 #l88> li>*:first-child:before {counter-increment: e1; content: counter(e1, decimal)". "; color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l88> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 #l89 {padding-left: 0pt; }
 #l89> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l90 {padding-left: 0pt; }
 #l90> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l91 {padding-left: 0pt; }
 #l91> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l92 {padding-left: 0pt; }
 #l92> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l93 {padding-left: 0pt; }
 #l93> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l94 {padding-left: 0pt; }
 #l94> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l95 {padding-left: 0pt; }
 #l95> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l96 {padding-left: 0pt; }
 #l96> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l97 {padding-left: 0pt; }
 #l97> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l98 {padding-left: 0pt; }
 #l98> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l99 {padding-left: 0pt; }
 #l99> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l100 {padding-left: 0pt; }
 #l100> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l101 {padding-left: 0pt; }
 #l101> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l102 {padding-left: 0pt; }
 #l102> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l103 {padding-left: 0pt; }
 #l103> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l104 {padding-left: 0pt; }
 #l104> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l105 {padding-left: 0pt; }
 #l105> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l106 {padding-left: 0pt; }
 #l106> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l107 {padding-left: 0pt; }
 #l107> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l108 {padding-left: 0pt; }
 #l108> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l109 {padding-left: 0pt; }
 #l109> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l110 {padding-left: 0pt; }
 #l110> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l111 {padding-left: 0pt; }
 #l111> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l112 {padding-left: 0pt; }
 #l112> li>*:first-child:before {content: "· "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l113 {padding-left: 0pt; }
 #l113> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l114 {padding-left: 0pt; }
 #l114> li>*:first-child:before {content: "■ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l115 {padding-left: 0pt; }
 #l115> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l116 {padding-left: 0pt; }
 #l116> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l117 {padding-left: 0pt; }
 #l117> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l118 {padding-left: 0pt; }
 #l118> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l119 {padding-left: 0pt; }
 #l119> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l120 {padding-left: 0pt; }
 #l120> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l121 {padding-left: 0pt; }
 #l121> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l122 {padding-left: 0pt; }
 #l122> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l123 {padding-left: 0pt; }
 #l123> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l124 {padding-left: 0pt; }
 #l124> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l125 {padding-left: 0pt; }
 #l125> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l126 {padding-left: 0pt; }
 #l126> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l127 {padding-left: 0pt;counter-reset: e1 1; }
 #l127> li>*:first-child:before {counter-increment: e1; content: counter(e1, decimal)". "; color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l127> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 li {display: block; }
 #l128 {padding-left: 0pt; }
 #l128> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 13pt; }
 li {display: block; }
 #l129 {padding-left: 0pt; }
 #l129> li>*:first-child:before {content: "● "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l130 {padding-left: 0pt; }
 #l130> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l131 {padding-left: 0pt; }
 #l131> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l132 {padding-left: 0pt; }
 #l132> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 #l133 {padding-left: 0pt; }
 #l133> li>*:first-child:before {content: "○ "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt; }
 table, tbody {vertical-align: top; overflow: visible; }
</style></head><body><p class="s1" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Compound Protocol</p><p class="s2" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="s3">Final</span>] Version 2.1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;line-height: 1pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Constants</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:5.375pt" cellspacing="0"><tr style="height:25pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#1F2329"><p class="s5" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Constant</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#1F2329"><p class="s5" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">liquidationIncentive</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: left;">A multiplier representing the excess percent value that a user calling liquidate receives, e.g. 1.05 for a 5% bonus. This discount applies to the asset being seized (that is, what was used as collateral).</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">collateralFactor</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 14pt;text-indent: 0pt;text-align: justify;">A multiplier represtsenting the amount you can borrow against your collateral, e.g. .9 to allow borrowing 90% of collateral value. Must be between 0 and 1.</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">closeFactor</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A number greater than 0.05 and less than or equal to 0.9 which is multiplied by a given asset&#39;s <i>borrowCurrent </i>to calculate the maximum <i>repayAmount </i>when liquidating a borrow for an underwater account.</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">maxAssets</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: left;">The max number of assets a single account can participate in (borrow or use as collateral). This does not affect accounts which mint, redeem or transfer without borrowing.</p></td></tr><tr style="height:39pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">reserveFactor</p></td><td style="width:361pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The portion of accrued interest that goes into reserves, between [0, 1], and likely below 0.10.</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-top: 16pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Key Terms</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:5.375pt" cellspacing="0"><tr style="height:25pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#1F2329"><p class="s5" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Value</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#1F2329"><p class="s5" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr style="height:68pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">borrowCurrent</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">The user’s borrow of a given asset, including accrued interest as of the current block. This is the user&#39;s stored principal, times the market&#39;s current interest index divided by the user&#39;s stored interest index.</p></td></tr><tr style="height:125pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">sumCollateral</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">The collateral value of a user&#39;s supplied assets, including accrued interest, in terms of ether. This is the sum over all assets of user&#39;s token balance, times the (stored) underlying exchange rate of that token, times the value of that asset in terms of eth, times the the asset&#39;s <i>collateralFactor</i>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">Note: we use the stored exchange rate here, instead of calculating a new exchange rate for each collateral asset. The delta should be small</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:5.375pt" cellspacing="0"><tr style="height:25pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s8" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">and this is only used for account liquidity checks.</p></td></tr><tr style="height:39pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">sumBorrow</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The value of a users borrowed assets, including accrued interest, in Ether. That is, the sum of <span class="s9">borrowCurrent </span>for each of a user&#39;s assets.</p></td></tr><tr style="height:68pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">accountLiquidity</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The <span class="s9">sumCollateral </span>value of a user’s account, denominated in Ether, minus the sumBorrow (for the case where <span class="s9">sumCollateral </span>≥ <span class="s9">sumBorrow</span>). This number may be below zero for unhealthy accounts.</p></td></tr><tr style="height:39pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">maxCloseValue</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">A user’s borrow balance in a given asset, multiplied by the closeFactor; how much value can be repaid by a liquidator.</p></td></tr><tr style="height:68pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">seizeTokens</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">The number of cTokens to transfer from the liquidated user to the liquidator. This is the <i>seizeAmount</i>, times the liquidation incentive, times the ratio of the oracle prices for the given asset pair, divided by the exchange rate of the collateral asset.</p></td></tr><tr style="height:96pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">totalBorrowBalance</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 16pt;text-indent: 0pt;text-align: left;">The total borrow balance, with accrued interest, across all accounts in a money market, as of the current block.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 4pt;padding-right: 2pt;text-indent: 0pt;text-align: left;">Note: totalBorrowBalance will be strictly larger than totalBorrows from v1, so the result of interest rate calculations will be different if we use the same interest rate models.</p></td></tr><tr style="height:39pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s10" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">assets<span class="s11">account</span></p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;line-height: 15pt;text-align: left;">A set of markets that an account has participated in with a max size of</p><p class="s6" style="padding-left: 4pt;text-indent: 0pt;line-height: 14pt;text-align: left;">maxAssets</p></td></tr><tr style="height:98pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">blocks</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">When calculating simple interest, blocks refers to the number of blocks that have elapsed since the last time the interest index was calculated. That most recent block is stored as <span class="s12">interestBlockNumber</span><span class="s13">asset </span>and is stored whenever an interest index is stored, and blocks is calculated as the current block&#39;s number minus <span class="s12">interestBlockNumber</span><span class="s13">asset </span>.</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">rate</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;padding-right: 11pt;text-indent: 0pt;text-align: left;">When calculating simple interest, rate refers to the current interest rate of the market. This was the previous rate that&#39;s been &quot;in effect&quot; for <span class="s9">blocks </span>blocks.</p></td></tr><tr style="height:54pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Exchange Rate Stored</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The last stored exchange rate for cTokens to underlying assets. This value does not include borrowing interest since the last interest accrual in this market.</p></td></tr><tr style="height:39pt"><td style="width:138pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s9" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Exchange Rate Current</p></td><td style="width:360pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s7" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The current exchange rate (including all trued up borrowing interest) between cTokens and the underlying asset.</p></td></tr></table><p class="s4" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Exceptional States</p><p style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">We assume that in <i>any </i>error condition, either a) the protocol exits gracefully with an event describing the error if no side-effects have yet occurred, or b) the transaction fails completely. Any exceptions to this rule are noted, except as below.</p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">A number of functions are split into two commands: accrue interest and a <i>fresh </i>action. The goal is to separate two discrete events which should occur. First, every time we accrue interest for a market, we help true up balances (and turn simple interest into compound interest) for that market. Second, the fresh functions are only correct if the market&#39;s interest has been fully accumulated as of this block. With updated interest, however, these fresh functions have divergent concerns (often, significantly unrelated to interest accrual). We thus build these functions as the sum of two actions to simplify the understanding and modelling of these two separate acts. In practice, this means that even when a method fails gracefully, the transaction may still accrue interest for that market (this is a good thing!).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Interest Rate Model Contract</p><p style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">For each asset, there is an interest index. We effectively track the growth of principal of an arbitrary account over time. We use the ratio of that account&#39;s interest versus initial principal to calculate the growth of any given account&#39;s interest over a subset of that time interval. The interest model contract specifies the simple interest rate at any moment (which, when compounded for each transaction becomes compound interest). We force this interest rate model to be a pure function over the cash, borrows, and reserves of an asset in the market.</p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">For more information, see <b>Interest Index Calculation Appendix</b>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">borrowRate(<span style=" color: #B6B6B6;">address </span>cToken, <span style=" color: #B6B6B6;">amount </span>cash, <span style=" color: #B6B6B6;">amount </span>borrows, <span style=" color: #B6B6B6;">amount </span>reserves) returns <span style=" color: #B6B6B6;">uint</span></h2><ul id="l1"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return the current interest rate for the market</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Note: cToken is the Compound cToken contract, not the underlying asset address.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Price Oracle Contract</p><p style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The Compound Protocol uses prices from a smart contract called a price oracle. The Comptroller and Liquidate Borrow functions reference the prices in this oracle. Multiple oracles may exist for the different Compound markets.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">getUnderlyingPrice( <span style=" color: #B6B6B6;">CToken </span>cToken) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return price of the underlying asset (as a mantissa)</p><p class="s4" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">cToken Contract</p><p style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">cTokens act as ERC-20 interfaces and will be the primary location where users interact with the Compound Protocol. When a user mints, redeems, borrows, repays borrows, liquidates a borrow, or transfers cTokens, she will do so on the cToken contract itself. The only actions that a user performs on another contract are entering and exiting assets via the Comptroller (see below for the <b>Comptroller contract</b>).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: justify;">cTokens each reference an <i>underlying</i>. This is usually the underlying ERC-20 contract, though it may be Ether itself or a complex asset. cTokens are the ultimate holders of that underlying asset balance and each call to take in or send out assets originates in the cToken contract.</p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: justify;">Initially, cEth (Compound Ether token) will be a unique asset, interacting with Ether instead of ERC-20 assets.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Note about cToken Money Markets</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The Money Market was the core monolith of the Compound Protocol in the first version. The functions that used to exist in the Money Market now exist in the cTokens, and the old <i>Market </i>struct is flattened in to each cToken Market. Functions related to Policies and Liquidity are deferred to the Comptroller contract.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Market Functions</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">borrowRatePerBlock()</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Returns the current per-block borrow interest rate mantissa for this cToken</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">supplyRatePerBlock()</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the supply rate:</p><ul id="l2"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">underlying <span class="s18">= </span>totalSupply <span class="s18">× </span>exchangeRate</p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowsPer <span class="s18">= </span>totalBorrows <span class="s18">÷ </span>underlying</p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">supplyRate <span class="s18">= </span>borrowRate <span class="s18">× (1 − </span>reserveFactor<span class="s18">) × </span>borrowsPer</p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Returns the current per-block supply interest rate mantissa for this cToken</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Accrue Interest()</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">We accrue interest and update the borrow index on every operation. This increases compounding, approaching the true value, regardless of whether the rest of the operation succeeds or not.</p><ul id="l3"><li data-list-text="●"><p class="s17" style="padding-top: 4pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">totalCash <span class="s18">= </span>invoke getCashPrior<span class="s18">()</span></p><ul id="l4"><li data-list-text="○"><p class="s14" style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: likely makes an external call</p></li></ul></li></ul><ul id="l5"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We get the interest rate (that was in effect since the last update):</p><ul id="l6"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowRate <span class="s18">= </span>call interestModel<span class="s18">.</span>borrowRate<span class="s18">(</span>this<span class="s18">, </span>totalCash<span class="s18">, </span>totalBorrows<span class="s18">, </span>totalReserves<span class="s18">)</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">simpleInterestF actor <span class="s18">= Δ</span>blocks <span class="s18">× </span>borrowRate</p></li></ul></li><li data-list-text="●"><p class="s19" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We update <span class="s20">borrowIndex </span>:</p><ul id="l7"><li data-list-text="○"><p class="s20" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowIndexNew <span class="s21">= </span>borrowIndex <span class="s21">× (1 + </span>simpleInterestF actor<span class="s21">)</span></p></li></ul></li><li data-list-text="●"><p class="s19" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the interest accrued:</p><ul id="l8"><li data-list-text="○"><p class="s20" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">interestAccumulated <span class="s21">= </span>totalBorrows <span class="s21">× </span>simpleInterestF actor</p></li></ul></li><li data-list-text="●"><p class="s19" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We update <span class="s20">borrows </span>and <span class="s17">reserves </span>:</p><ul id="l9"><li data-list-text="○"><p class="s20" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalBorrowsNew <span class="s21">= </span>totalBorrows <span class="s21">+ </span>interestAccumulated</p><ul id="l10"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalReservesNew <span class="s18">= </span>totalReserves <span class="s18">+ </span>interestAccumulated <span class="s18">× </span>reserveFactor</p></li></ul></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We store the updates back to the blockchain:</p><ul id="l11"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>accrualBlockNumber <span class="s18">= </span>getBlockNumber<span class="s18">()</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>borrowIndex <span class="s18">= </span>borrowIndexNew</p></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>totalBorrows <span class="s18">= </span>totalBorrowsNew</p></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>totalReserves <span class="s18">= </span>totalReservesNew</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit an <b>AccrueInterest </b>event</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CErc20] </span>Mint(<span style=" color: #999;">uint </span>mintAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Mint Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>mintAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s22" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[CEther] <span class="h2">Mint() payable</span></p></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Mint Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>msg<span class="s18">.</span>value<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] Mint Fresh(<span style=" color: #999;">address </span>minter, <span style=" color: #999;">uint </span>mintAmount)</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">User supplies assets from her own address into the market and receives a balance of cTokens in exchange.</p></li><li data-list-text="●"><p class="s17" style="padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>mintAllowed<span class="s18">(</span>this<span class="s18">, </span>minter<span class="s18">, </span>mintAmount<span class="s18">) =/ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>invoke checkTransferIn(minter, mintAmount) </i>fails</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We get the current exchange rate and calculate the number of cTokens to be minted:</p><ul id="l12"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 81pt;text-indent: -22pt;text-align: left;">exchangeRate <span class="s18">= </span>invoke Exchange Rate Stored<span class="s18">()</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">mintTokens <span class="s18">= </span>mintAmount <span class="s18">÷ </span>exchangeRate</p><ul id="l13"><li data-list-text="■"><p style="padding-top: 4pt;padding-left: 113pt;text-indent: -18pt;line-height: 112%;text-align: left;">Note: divisions are rounded, as necessary, toward zero, thus it is possible to mint 0 tokens</p></li></ul></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the new total supply of cTokens and <i>minter </i>token balance:</p><ul id="l14"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalSupplyNew <span class="s18">= </span>totalSupply <span class="s18">+ </span>mintTokens</p><ul id="l15"><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fails on overflow</p></li></ul></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountTokensNew<span class="s24">minter </span><span class="s18">=</span></p><ul id="l16"><li data-list-text="■"><p style="padding-top: 1pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fails on overflow</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">accountTokens<span class="s24">minter </span><span class="s18">+ </span>mintTokens</p></li></ul></li></ul></li><li data-list-text="●"><p class="s15" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">We have finished calculations<span class="p">. (If any calculations failed with an error, we have already returned with a failure code). Now we can begin effects.</span></p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We invoke <i>doTransferIn </i>for the <i>minter </i>and the <i>mintAmount</i></p><ul id="l17"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: The cToken must handle variations between ERC-20 and ETH underlying.</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">On success, the cToken holds an additional <i>mintAmount </i>of cash</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">If <i>doTransferIn </i>fails despite the fact we checked pre-conditions, we revert because we can&#39;t be sure if side effects occurred</p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We write previously calculated values into storage:</p><ul id="l18"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Set <span class="s17">totalSupply</span></p><p class="s18" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">= <i>cTokenSupplyNew</i></p></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -77pt;text-align: right;"><span class="p">Set </span>accountTokens<span class="s24">minter </span><span class="s18">= </span>accountTokensNew<span class="s24">minter</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -41pt;text-align: right;">Emit a <b>Mint </b>event with <span class="s17">minter </span>, <span class="s17">mintAmount </span>, <span class="s17">mintTokens</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>Transfer </b>event from <i>this </i>to <i>minter</i></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>mintV erify<span class="s18">(</span>this<span class="s18">, </span>minter<span class="s18">, </span>mintAmount<span class="s18">, </span>mintTokens<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Redeem(<span style=" color: #999;">uint </span>redeemTokens)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Redeem Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>redeemTokens<span class="s18">, 0)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Redeem Underlying(<span style=" color: #999;">uint </span>redeemAmount)</h2></li><li data-list-text="●"><p style="padding-top: 5pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li></ul><ul id="l19"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Redeem Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, 0, </span>redeemAmount<span class="s18">)</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 122%;text-align: left;">[<span class="h3">Internal</span>] Redeem Fresh(<span style=" color: #999;">address </span>redeemer, <span style=" color: #999;">uint </span>redeemTokensIn, <span style=" color: #999;">uint </span>redeemAmountIn) <span class="p">User relinquishes cTokens and receives the underlying ERC-20 asset from the protocol into her own wallet.</span></h2><ul id="l20"><li data-list-text="●"><p class="s17" style="padding-left: 43pt;text-indent: -20pt;line-height: 14pt;text-align: left;">exchangeRate <span class="s18">= </span>invoke Exchange Rate Stored<span class="s18">()</span></p></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">If <span class="s17">redeemTokensIn </span><span class="s18">&gt; 0 :</span></p><ul id="l21"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">We get the current exchange rate and calculate the amount to be redeemed:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Else:</p><ul id="l22"><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">redeemTokens</p></li><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">redeemAmount</p><p class="s18" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">= <i>redeemTokensIn</i></p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>redeemTokensIn </i>× <i>exchangeRate</i></p><ul id="l23"><li data-list-text="○"><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">We get the current exchange rate and calculate the amount to be redeemed:</p><ul id="l24"><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">redeemTokens</p></li><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">redeemAmount</p></li></ul></li></ul></li></ul><p class="s18" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">= <i>redeemAmountIn </i>÷ <i>exchangeRate</i></p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>redeemAmountIn</i></p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>redeemAllowed<span class="s18">(</span>this<span class="s18">, </span>redeemer<span class="s18">, </span>redeemTokens<span class="s18">) =/ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the new total supply and <i>redeemer </i>token balance:</p><ul id="l25"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalSupplyNew <span class="s18">= </span>totalSupply <span class="s18">− </span>redeemTokens</p><ul id="l26"><li data-list-text="■"><p style="padding-top: 4pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fails if <span class="s17">redeemTokens</span></p></li></ul></li></ul></li></ul><ul id="l27"><li data-list-text="&gt;"><p class="s17" style="padding-top: 4pt;padding-left: 19pt;text-indent: -14pt;text-align: left;">totalSupply</p><ul id="l28"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountTokensNew<span class="s24">redeemer </span><span class="s18">= </span>accountTokens<span class="s24">redeemer </span><span class="s18">− </span>redeemTokens</p><ul id="l29"><li data-list-text="■"><p class="s17" style="padding-top: 2pt;padding-left: 113pt;text-indent: -18pt;text-align: left;"><span class="p">Fails if </span>redeemTokens <span class="s18">&gt; </span>accountTokens<span class="s24">redeemer</span></p><ul id="l30"><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail gracefully if protocol has insufficient cash</p></li><li data-list-text="●"><p class="s15" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">We have finished calculations<span class="p">. (If any calculations failed with an error, we have already returned with a failure code). Now we can begin side effects.</span></p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We invoke <i>doTransferOut </i>for the <i>redeemer </i>and the <i>redeemAmount</i></p><ul id="l31"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: The cToken must handle variations between ERC-20 and ETH underlying.</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">On success, the cToken has <i>redeemAmount </i>less of cash</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">If <i>doTransferOut </i>fails despite the fact we checked pre-conditions, we revert because we can&#39;t be sure if side effects occurred</p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We write previously calculated values into storage</p><ul id="l32"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Set <span class="s17">totalSupply</span></p><p class="s18" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">= <i>totalSupplyNew</i></p></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>accountTokens<span class="s24">redeemer </span><span class="s18">= </span>accountTokensNew<span class="s24">redeemer</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>Redeem </b>event with <span class="s17">redeemer </span>, <span class="s17">redeemAmount </span>, <span class="s17">redeemTokens</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>Transfer </b>event from <i>redeemer </i>to <i>this</i></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>redeemV erify<span class="s18">(</span>this<span class="s18">, </span>redeemer<span class="s18">, </span>redeemAmount<span class="s18">, </span>redeemTokens<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Borrow(<span style=" color: #999;">uint </span>borrowAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Borrow Asset Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>borrowAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] BorrowFresh(<span style=" color: #999;">address </span>borrower, <span style=" color: #999;">uint </span>borrowAmount)</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">User borrows assets from the protocol.</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>borrowAllowed<span class="s18">(</span>this<span class="s18">, </span>borrower<span class="s18">, </span>borrowAmount<span class="s18">) =/ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the new borrower and total borrow balances:</p><ul id="l33"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountBorrows <span class="s18">= </span>invoke Borrow Balance Stored<span class="s18">(</span>borrower<span class="s18">)</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountBorrowsNew <span class="s18">= </span>accountBorrows <span class="s18">+ </span>borrowAmount</p><ul id="l34"><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fails on overflow</p></li></ul></li><li data-list-text="○"><p class="s17" style="padding-top: 4pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalBorrowsNew <span class="s18">= </span>totalBorrows <span class="s18">+ </span>borrowAmount</p><ul id="l35"><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fails on overflow</p></li></ul></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail gracefully if protocol has insufficient cash</p></li><li data-list-text="●"><p class="s15" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">We have finished calculations<span class="p">. (If any calculations failed with an error, we have already returned with a failure code). Now we can begin side effects.</span></p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We invoke <i>doTransferOut </i>for the <i>borrower </i>and the <i>borrowAmount</i></p><ul id="l36"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: The cToken must handle variations between ERC-20 and ETH underlying</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">On success, the cToken has <i>borrowAmount </i>less of underlying cash</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">If <i>doTransferOut </i>fails despite the fact we checked pre-conditions, we revert because we can&#39;t be sure if side effects occurred</p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We write the previously calculated values into storage:</p><ul id="l37"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>accountBorrows<span class="s24">borrower </span><span class="s18">= {</span>accountBorrowsNew<span class="s18">, </span>borrowIndex<span class="s18">}</span></p></li><li data-list-text="○"><p style="padding-top: 1pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Set <span class="s17">totalBorrows</span></p><p class="s18" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>totalBorrowsNew</i></p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>Borrow </b>event with <span class="s17">borrower </span>, <span class="s17">borrowAmount </span>, <span class="s17">accountBorrowsNew </span><i>,</i></p><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">totalBorrowsNew</p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>borrowV erify<span class="s18">(</span>this<span class="s18">, </span>borrower<span class="s18">, </span>borrowAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CErc20] </span>Repay Borrow(<span style=" color: #999;">uint </span>repayAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">return </span>invoke Repay Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>repayAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s22" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[CEther] <span class="h2">Repay Borrow() payable</span></p></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">return </span>invoke Repay Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>msg<span class="s18">.</span>value<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CErc20] </span>Repay Borrow Behalf(<span style=" color: #999;">address </span>borrower, <span style=" color: #999;">uint </span>repayAmount)</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">Repays a borrow on behalf of another user. The message sender is still the payer, but you can specify a different account to pay against.</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Repay Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>borrower<span class="s18">, </span>repayAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CEther] </span>Repay Borrow Behalf(<span style=" color: #999;">address </span>borrower) payable</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">Repays a borrow on behalf of another user. The message sender is still the payer, but you can specify a different account to pay against.</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke Repay Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>borrower<span class="s18">, </span>msg<span class="s18">.</span>value<span class="s18">)</span></p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] Repay Borrow Fresh(<span style=" color: #999;">address </span>payer, <span style=" color: #999;">address </span>borrower, <span style=" color: #999;">uint </span>repayAmount)</h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Borrows are repaid by the <i>payer </i>(possibly the same as the <i>borrower</i>).</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>repayBorrowAllowed<span class="s18">(</span>this<span class="s18">, </span>payer<span class="s18">, </span>borrower<span class="s18">, </span>repayAmount<span class="s18">) =/ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We fetch the amount the <i>borrower </i>owes, with accumulated interest:</p><ul id="l38"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountBorrows <span class="s18">= </span>invoke Borrow Balance Stored<span class="s18">(</span>borrower<span class="s18">)</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">If <span class="s17">repayAmount </span><span class="s18">= −1</span></p><ul id="l39"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">repayAmount <span class="s18">= </span>accountBorrows</p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>checkTransferIn(underlying, payer, repayAmount) </i>fails</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the new borrower and total borrow balances:</p><ul id="l40"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountBorrowsNew <span class="s18">= </span>accountBorrows <span class="s18">− </span>repayAmount</p><ul id="l41"><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;"><span class="p">Fails if </span>repayAmount <span class="s18">&gt; </span>accountBorrows</p></li></ul></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalBorrowsNew <span class="s18">= </span>totalBorrows <span class="s18">− </span>repayAmount</p><ul id="l42"><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;"><span class="p">Fails if </span>repayAmount <span class="s18">&gt; </span>totalBorrows</p></li></ul></li></ul></li><li data-list-text="●"><p class="s15" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">We have finished calculations<span class="p">. (If any calculations failed with an error, we have already returned with a failure code). Now we can begin effects.</span></p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We call <i>doTransferIn </i>for the <i>payer </i>and the <i>repayAmount</i></p><ul id="l43"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: The cToken must handle variations between ERC-20 and ETH underlying</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">On success, the cToken holds an additional <i>repayAmount </i>of cash</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">If <i>doTransferIn </i>fails despite the fact we checked pre-conditions, we revert because we can&#39;t be sure if side effects occurred</p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">We write the previously calculated values into storage:</p><ul id="l44"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>accountBorrows<span class="s24">borrower </span><span class="s18">= {</span>accountBorrowsNew<span class="s18">, </span>borrowIndex<span class="s18">}</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Set </span>totalBorrows <span class="s18">= </span>totalBorrowsNew</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>RepayBorrow </b>event with <span class="s17">payer </span>, <span class="s17">borrower </span>, <span class="s17">repayAmount </span>, <span class="s17">accountBorrowsNew </span>,</p><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">totalBorrowsNew</p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>repayBorrowV erify<span class="s18">(</span>this<span class="s18">, </span>payer<span class="s18">, </span>borrower<span class="s18">, </span>repayAmount<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CErc20] </span>Liquidate Borrow(<span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #999;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">uint </span>repayAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li></ul><ul id="l45"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Check </span>call cTokenCollateral<span class="s18">.</span>Accrue Interest<span class="s18">() = 0</span></p></li></ul><ul id="l46"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return</p><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">invoke Liquidate Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>borrower<span class="s18">, </span>repayAmount<span class="s18">, </span>cTokenCollateral<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s22">[CEther] </span>Liquidate Borrow(<span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #999;">CToken </span>cTokenCollateral) payable</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li></ul><ul id="l47"><li data-list-text="●"><p class="s17" style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Check </span>call cTokenCollateral<span class="s18">.</span>Accrue Interest<span class="s18">() = 0</span></p></li></ul><ul id="l48"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return</p><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">invoke Liquidate Borrow Fresh<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>borrower<span class="s18">, </span>msg<span class="s18">.</span>value<span class="s18">, </span>cTokenCollateral<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] Liquidate Borrow Fresh(<span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #999;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>repayAmount, <span style=" color: #999;">CToken </span>cTokenCollateral)</h2><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The liquidator repays an amount of the underlying asset in this market, on behalf of an underwater borrower, and seizes the appropriate number of tokens in the collateral market.</p></li><li data-list-text="●"><p class="s17" style="padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>liquidateBorrowAllowed<span class="s18">(</span>this<span class="s18">, ...</span>arguments<span class="s18">) =/ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify <i>cTokenCollateral </i>market&#39;s <i>block number </i>equals current block number</p><ul id="l49"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call cTokenCollateral<span class="s18">.</span>accrualBlockNumber<span class="s18">() =/ </span>block<span class="s18">.</span>number</p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>liquidator <span class="s18">= </span>borrower</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">repayAmount </span><span class="s18">= 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">repayAmount </span><span class="s18">=− 1</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the number of collateral tokens that will be seized:</p><ul id="l50"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">seizeT okens <span class="s18">= </span>call comptroller<span class="s18">.</span>liquidateCalculateSeizeT okens</p><p class="s18" style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">(<i>this</i>, <i>cTokenCollateral</i>, <i>repayAmount</i>)</p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>seizeT okens <span class="s18">&gt; </span>cTokenCollateral<span class="s18">.</span>balanceOf <span class="s18">(</span>borrower<span class="s18">)</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>invoke Repay Borrow Fresh<span class="s18">(</span>liquidator<span class="s18">, </span>borrower<span class="s18">, </span>repayAmount<span class="s18">) ≠ 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Revert if </span>call cTokenCollateral<span class="s18">.</span>seize<span class="s18">(</span>liquidator<span class="s18">, </span>borrower<span class="s18">, </span>seizeT okens<span class="s18">) ≠ 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>LiquidateBorrow </b>event with <span class="s17">liquidator</span><span class="s18">, </span><span class="s17">borrower </span>, <span class="s17">repayAmount </span>,</p><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">cTokenCollateral <span class="p">, </span>seizeT okens</p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>liquidateBorrowV erify<span class="s18">(</span>this<span class="s18">, ...</span>arguments<span class="s18">, ...</span>state<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">seize(<span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>seizeTokens) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if</p><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">call comptroller<span class="s18">.</span>seizeAllowed<span class="s18">(</span>this<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>liquidator<span class="s18">, </span>borrower<span class="s18">, </span>seizeT okens<span class="s18">) =/ 0</span></p><ul id="l51"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">Note: It’s critical that the collateral contract uses <i>msg.sender </i>as the address of the borrowed CToken which it verifies with the Comptroller. If a parameter were used, then anyone would be able to spoof this call.</p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>borrower <span class="s18">= </span>liquidator</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the new borrower and liquidator token balances:</p><ul id="l52"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowerTokensNew <span class="s18">= </span>accountTokens<span class="s18">[</span>borrower<span class="s18">] − </span>seizeT okens</p><ul id="l53"><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fail on underflow</p></li></ul></li><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">liquidatorT okensNew <span class="s18">= </span>accountTokens<span class="s18">[</span>liquidator<span class="s18">] + </span>seizeT okens</p><ul id="l54"><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Fail on overflow</p></li></ul></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We write the previously calculated values into storage:</p><ul id="l55"><li data-list-text="○"><p class="s17" style="padding-top: 4pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountTokens<span class="s18">[</span>borrower<span class="s18">] = </span>borrowerTokensNew</p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">accountTokens<span class="s18">[</span>liquidator<span class="s18">] = </span>liquidatorT okensNew</p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit a <b>Transfer </b>event</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">.</span>seizeV erify<span class="s18">(</span>this<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>liquidator<span class="s18">, </span>borrower<span class="s18">, </span>seizeT okens<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Administrative Functions</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">constructor(<span style=" color: #B6B6B6;">EIP20 </span>underlying,<span style=" color: #B6B6B6;">address </span>interestRateModel, <span style=" color: #B6B6B6;">address </span>comptroller, scaled initialExchangeRate)</h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set <i>admin </i>to msg.sender</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set underlying to <i>underlying</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set initialExchangeRate to <i>initialExchangeRate</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set marketBlockNumber to block number</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set market borrow index to 1e18</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set reserve factor to 0</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke <span class="s18">_</span>setMarketInterestRateModelFresh<span class="s18">(</span>interestRateModel<span class="s18">)</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke <span class="s18">_</span>setMarketComptroller<span class="s18">(</span>comptroller<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">_setReserveFactor(<span style=" color: #B6B6B6;">scaled </span>newReserveFactor)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <i>_setReserveFactorFresh(newReserveFactor)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] _setReserveFactorFresh(<span style=" color: #B6B6B6;">scaled </span>newReserveFactor)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We verify market&#39;s <i>block number </i>equals current block number</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Check </span>newReserveFactor <span class="s18">≤ </span>maxReserveFactor</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <i>reserveFactor </i>with value <i>newReserveFactor</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewReserveFactor</b><i>(oldReserveFactor, newReserveFactor)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_reduceReserves(<span style=" color: #B6B6B6;">uint </span>amount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <i>_reduceReservesFresh(amount)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] _reduceReservesFresh(<span style=" color: #B6B6B6;">uint </span>reduceAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin</i></p></li></ul><ul id="l56"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We verify market&#39;s <i>block number </i>equals current block number</p></li></ul><ul id="l57"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <i>amount </i>≤ <span class="s17">reserves</span><span class="s25">n</span></p></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail gracefully if protocol has insufficient underlying cash</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <span class="s17">reserves</span><span class="s24">n</span><span class="s26">+1 </span><span class="s27">=</span></p><p class="s17" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">reserves<span class="s25">n</span> <span class="s18">−</span></p><p class="s17" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">reduceAmount</p></li><li data-list-text="●"><p class="s17" style="padding-top: 1pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke doTransferOut<span class="s18">(</span>underlying<span class="s18">, </span>reduceAmount<span class="s18">, </span>admin<span class="s18">)</span></p><ul id="l58"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Note: we revert on the failure of this command</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewReserves</b>(<i>admin</i>, <span class="s17">reduceAmount </span>, <span class="s17">reserves</span><span class="s24">n</span><span class="s26">+1 </span>)</p><h2 style="padding-top: 15pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">_setPendingAdmin(<span style=" color: #B6B6B6;">address </span>newPendingAdmin)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <i>pendingAdmin </i>with value <i>newPendingAdmin</i></p></li></ul><ul id="l59"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingAdmin</b><i>(oldPendingAdmin, newPendingAdmin)</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_acceptAdmin()</h2><ul id="l60"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>pendingAdmin </i>and <i>pendingAdmin </i>≠ address(0)</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <i>admin </i>with value <i>pendingAdmin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Unset <i>pendingAdmin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewAdmin</b><i>(oldAdmin, newAdmin)</i></p></li></ul><ul id="l61"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingAdmin</b><i>(oldPendingAdmin, 0)</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setInterestRateModel(<span style=" color: #B6B6B6;">address </span>newInterestRateModel)</h2><ul id="l62"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <span class="s17">invoke Accrue Interest</span><span class="s18">() = 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return <i>_setFreshInterestModelFresh(newInterestRateModel)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] _setInterestRateModelFresh(<span style=" color: #B6B6B6;">address </span>newInterestRateModel)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin</i></p></li></ul><ul id="l63"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We assert market&#39;s <i>block number </i>equals current block number</p></li></ul><ul id="l64"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Track the market&#39;s current interest rate model</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call newInterestRateModel<span class="s18">.</span>isInterestRateModel<span class="s18">() </span><span class="p">returns true</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set the interest rate model to <i>newInterestRateModel</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewInterestRateModel</b>(<i>oldInterestRateModel</i>, <i>newInterestRateModel</i>)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setComptroller(<span style=" color: #B6B6B6;">address </span>newComptroller)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Track asset&#39;s current comptroller as <i>oldComptroller</i></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call comptroller<span class="s18">.</span>isComptroller<span class="s18">() </span><span class="p">returns true</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set comptroller to <i>newComptroller</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewComptroller</b>(<i>oldComptroller</i>, <i>newComptroller</i>)</p><h1 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Token Functions</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">name() returns <span style=" color: #B6B6B6;">string</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <i>name</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">symbol() returns <span style=" color: #B6B6B6;">string</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <i>symbol</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">decimals() returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <i>decimals</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">External</span>] getCash() returns <span style=" color: #999;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <span class="s17">call getCashPrior</span><span class="s18">()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">transfer(<span style=" color: #999;">address </span>to, <span style=" color: #999;">uint </span>amount) returns <span style=" color: #999;">bool</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke transferT okens<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>to<span class="s18">, </span>amount<span class="s18">)</span></p><ul id="l65"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Revert if not successful</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Emit <b>Transfer</b><i>(msg.sender, to, tokens)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">transferFrom(<span style=" color: #999;">address </span>from, <span style=" color: #999;">address </span>to, <span style=" color: #999;">uint </span>amount) returns <span style=" color: #999;">bool</span></h2></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke transferT okens<span class="s18">(</span>msg<span class="s18">.</span>sender<span class="s18">, </span>f rom<span class="s18">, </span>to<span class="s18">, </span>amount<span class="s18">)</span></p><ul id="l66"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Revert if not successful</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Emit <b>Transfer</b><i>(from, to, tokens)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] transferTokens(<span style=" color: #B6B6B6;">address </span>spender, <span style=" color: #B6B6B6;">address </span>src, <span style=" color: #B6B6B6;">address </span>dst, <span style=" color: #B6B6B6;">uint </span>amount) returns <span style=" color: #B6B6B6;">uint</span></h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Transfer <i>amount </i>cTokens from <i>source </i>to <i>dest.</i></p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>call comptroller<span class="s18">.</span>redeemAllowed<span class="s18">(</span>this<span class="s18">, </span>src<span class="s18">, </span>amount<span class="s18">) </span><span class="p">returns false</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail unless </span><span class="s14">spender </span><span class="p">is </span><span class="s14">source </span><span class="p">or </span>cTokenAllowed<span class="s18">[</span>src<span class="s18">][</span>spender<span class="s18">] ≥ </span>amount</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>accountTokens<span class="s18">[</span>src<span class="s18">] &lt; </span>amount</p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">accountTokens<span class="s18">[</span>src<span class="s18">] −= </span>amount</p><ul id="l67"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Underflow is impossible due to check above</p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">accountTokens<span class="s18">[</span>dst<span class="s18">] += </span>amount</p><ul id="l68"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Fail on overflow</p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Unless </span>spender <span class="s18">= </span>src</p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;"><span class="s28">⋁ </span>cTokenAllowed<span class="s18">[</span>src<span class="s18">][</span>spender<span class="s18">] = </span>maxUint</p><ul id="l69"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">cTokenAllowed<span class="s18">[</span>src<span class="s18">][</span>spender<span class="s18">] −= </span>amount</p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">totalSupply() returns <span style=" color: #B6B6B6;">uint</span></h2></li></ul></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <span class="s17">totalSupply</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">allowance(<span style=" color: #999;">address </span>owner, <span style=" color: #999;">address </span>spender) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>cTokenAllowed<span class="s18">[</span>owner<span class="s18">][</span>spender<span class="s18">]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">balanceOf(<span style=" color: #999;">address </span>account) returns <span style=" color: #B6B6B6;">uint256</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>accountTokens<span class="s18">[</span>account<span class="s18">]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">balanceOfUnderlying(<span style=" color: #999;">address </span>account) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>accountTokens<span class="s18">[</span>account<span class="s18">] × </span>invoke Exchange Rate Current<span class="s18">()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">approve(<span style=" color: #999;">address </span>spender, <span style=" color: #999;">uint256 </span>amount) returns <span style=" color: #999;">bool</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Overwrite </span>cTokenAllowed<span class="s18">[</span>msg<span class="s18">.</span>sender<span class="s18">][</span>spender<span class="s18">] =</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>Approval</b><i>(msg.sender, spender, amount)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Exchange Rates</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Exchange Rate Current() returns <span style=" color: #B6B6B6;">uint</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 9pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">amount</p></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke Accrue Interest<span class="s18">()</span></p></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return <span class="s17">invoke Exchange Rate Stored</span><span class="s18">()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Exchange Rate Stored()</p></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Note: we do not assert that the market is up to date.</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">If there are no tokens minted:</p><ul id="l70"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">exchangeRate <span class="s18">= </span>initial exchange rate</p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Otherwise:</p><ul id="l71"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">totalCash <span class="s18">= </span>invoke getCash<span class="s18">()</span></p><ul id="l72"><li data-list-text="■"><p class="s14" style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Note: likely makes an external call</p></li></ul></li></ul><p style="text-indent: 0pt;text-align: left;"/><ul id="l73"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">exchangeRate <span class="s18">=</span></p></li></ul><p class="s30" style="padding-left: 58pt;text-indent: -52pt;line-height: 115%;text-align: left;">totalCash <span class="s31">+</span>totalBorrows<span class="s31">−</span>totalReserves totalSupply</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <span class="s17">exchangeRate</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Borrow Balances</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Total Borrows Current(<span style=" color: #999;">address </span>account) returns <span style=" color: #B6B6B6;">uint</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke Accrue Interest<span class="s18">()</span></p></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return <span class="s17">totalBorrows</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Borrow Balance Current(<span style=" color: #999;">address </span>account) returns <span style=" color: #B6B6B6;">uint</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke Accrue Interest<span class="s18">()</span></p></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">return <span class="s17">invoke Borrow Balance Stored</span><span class="s18">()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Borrow Balance Stored(<span style=" color: #B6B6B6;">address </span>borrower)</p></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Note: we do not assert that the market is up to date.</p></li></ul><ul id="l74"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We get from storage from the cToken:</p><ul id="l75"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowBalance<span class="s24">borrower </span><span class="s18">= </span>accountBorrows<span class="s18">[</span>borrower<span class="s18">]</span></p></li></ul></li></ul><ul id="l76"><li data-list-text="○"><p class="s17" style="padding-top: 1pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrowIndex<span class="s24">borrower </span><span class="s18">= </span>accountBorrowIndex<span class="s18">[</span>borrower<span class="s18">]</span></p></li></ul><ul id="l77"><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;line-height: 109%;text-align: left;">If <span class="s17">borrowBalance</span><span class="s24">borrower </span><span class="s18">= 0 </span>then <span class="s17">borrowIndex</span><span class="s24">borrower </span>is likely also 0. Rather than failing the calculation with a division by 0, we immediately return 0 in this case.</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">recentBorrowBalance<span class="s32">borrower </span><span class="s18">=</span></p><p class="s33" style="padding-left: 112pt;text-indent: 0pt;line-height: 11pt;text-align: center;">borrowBalance<span class="s34">borrower</span><span class="s35"> </span><span class="s36">×</span>borrowIndex<span class="s34">stored</span></p><p class="s30" style="padding-left: 112pt;text-indent: 0pt;line-height: 12pt;text-align: center;">borrowIndex<span class="s35">borrower</span></p></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <span class="s17">recentBorrowBalance</span><span class="s24">borrower</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Safe Token</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] checkTransferIn(<span style=" color: #999;">address </span>account, <span style=" color: #B6B6B6;">uint </span>underylingAmount) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call EIP <span class="s18">20(</span>underlying<span class="s18">).</span>allowance<span class="s18">(</span>account<span class="s18">, </span>address<span class="s18">(</span>this<span class="s18">)))</span></p><ul id="l78"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Fail if result is less than <i>underlyingAmount</i></p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call EIP <span class="s18">20(</span>underlying<span class="s18">).</span>balanceOf <span class="s18">(</span>account<span class="s18">))</span></p><ul id="l79"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Fail if result is less than <i>underlyingAmount</i></p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 18pt;text-align: left;">Return <span class="s37">👍</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] doTransferIn(<span style=" color: #999;">address </span>account, <span style=" color: #B6B6B6;">uint </span>underlyingAmount)</h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Revert if </span>msg<span class="s18">.</span>value <span class="s18">&gt; 0 </span><span class="p">since there is no valid use case for sending value by default</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call EIP <span class="s18">20(</span>underlying<span class="s18">).</span>transferF rom<span class="s18">(</span>account<span class="s18">, </span>address<span class="s18">(</span>this<span class="s18">), </span>underlyingAmount<span class="s18">)</span></p><ul id="l80"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Revert unless true</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" style=" color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt;" target="_blank">*Note: should handle </a><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" class="a" target="_blank">non-standard ERC-20 </a><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" target="_blank">tokens</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] getCashPrior() returns <span style=" color: #999;">uint</span></h2></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>call EIP <span class="s18">20(</span>underlying<span class="s18">).</span>balanceOf <span class="s18">(</span>address<span class="s18">(</span>this<span class="s18">)))</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] doTransferOut(<span style=" color: #999;">address </span>account, <span style=" color: #999;">uint </span>underlyingAmount)</h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call EIP <span class="s18">20(</span>underlying<span class="s18">).</span>transfer<span class="s18">(</span>account<span class="s18">, </span>underlyingAmount<span class="s18">)</span></p><ul id="l81"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Revert unless true</p></li><li data-list-text="○"><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" style=" color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt;" target="_blank">*Note: should handle </a><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" class="a" target="_blank">non-standard ERC-20 </a><a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca" target="_blank">tokens</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Safe Token (cETH)</h1><p class="s17" style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span class="p">In order to implement cETH, we add a fallback function that does </span>invoke mint<span class="s18">(</span>msg<span class="s18">.</span>value<span class="s18">) </span><span class="p">. In addition, we override the Safe Token methods as follows:</span></p><h2 style="padding-top: 13pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] checkTransferIn(<span style=" color: #999;">address </span>account, <span style=" color: #B6B6B6;">uint </span>underylingAmount) returns <span style=" color: #B6B6B6;">uint</span></h2></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>msg<span class="s18">.</span>sender <span class="s18">≠ </span>account</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 15pt;text-align: left;"><span class="p">Fail if </span>msg<span class="s18">.</span>value <span class="s18">≠ </span>underlyingAmount</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 20pt;text-align: left;">Return<span class="s37">👍</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] doTransferIn(<span style=" color: #999;">address </span>account, <span style=" color: #B6B6B6;">uint </span>underlyingAmount)</h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Fail if </span>msg<span class="s18">.</span>value <span class="s18">≠ </span>underlyingAmount</p><ul id="l82"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">We just sanity check, <i>checkTransferIn </i>should have already been called</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] getCashPrior() returns <span style=" color: #999;">uint</span></h2></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>this<span class="s18">.</span>balance <span class="s18">− </span>msg<span class="s18">.</span>value</p><ul id="l83"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Ensure we avoid underflow</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[<span class="h3">Internal</span>] doTransferOut(<span style=" color: #999;">address </span>account, <span style=" color: #999;">uint </span>underlyingAmount)</h2></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">invoke account<span class="s18">.</span>transfer<span class="s18">(</span>underlyingAmount<span class="s18">)</span></p><ul id="l84"><li data-list-text="○"><p style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Ensure minimum gas is attached to transfer</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Comptroller Contract</p><p class="s17" style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span class="p">The Comptroller implements the Liquidity Checker API specification. Most important of these are </span>liquidityChecker<span class="s18">. </span><span class="s14">redeemAllowed(), </span>liquidityChecker<span class="s18">. </span><span class="s14">borrowAllowed(), </span><span class="p">and </span>liquidityChecker<span class="s18">. </span><span class="s14">liquidateBorrowAllowed()</span><span class="p">.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The Comptroller also implements a defense hook mechanism to protect against unforeseen future vulnerabilities. These <i>*Verify </i>functions are currently no-ops, but provide a last resort to potentially revert any protocol transaction which would violate the intended behavior of the protocol and therefore put user assets at risk.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">Note: In order to seamlessly upgrade the Comptroller without changing the Comptroller address referenced by the cToken markets, we sometimes use a technique known as <i>delegate calls</i>.</p><h1 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">User Market Functions</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">These two functions (enter markets and exit market) will be called by the end-users directly. This will only be a requirement for users who wish to borrow. That is, token holders that do not borrow will not need to (and should not) call these functions.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Enter Markets(<span style=" color: #B6B6B6;">address[] </span>cTokens) returns <span style=" color: #999;">bool[]</span></h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The sender includes a list of asset addresses that should be used when calculating account liquidity. Before borrowing an asset, one or more supplied assets must be added in this way to provide collateral. Any asset to be borrowed must be added in this way before borrowing is allowed. The return value is a list of mapping the assets passed in to whether the user is ultimately in that market.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">For each cToken given as an argument:</p><ul id="l85"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">We check if the user is already in the cToken, if so, collect true, otherwise, proceed</p></li><li data-list-text="○"><p style="padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">We check if the user has reached maxAssets, if so, collect false, otherwise, proceed</p></li><li data-list-text="○"><p style="padding-left: 77pt;text-indent: -18pt;text-align: left;">We check if the cToken is listed, if not, collect false, otherwise, proceed.</p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">We check <span class="s17">oraclePrice</span><span class="s24">asset </span><span class="s18">≠ 0</span></p></li><li data-list-text="○"><p style="padding-top: 1pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">We add the asset to assets<span class="s38">user</span> , by pushing it into user’s assets list and setting</p><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: 0pt;text-align: left;">memberships<span class="s24">cToken</span><span class="s26">,</span><span class="s39">user </span><span class="p">to true, and collect true</span></p></li><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;">Proceed to the next asset, noting that the size of the list was increased if the previous item added to the list and the maxAssets comparison must occur against storage</p></li><li data-list-text="○"><p style="padding-left: 77pt;text-indent: -18pt;text-align: left;">Emit <b>MarketEntered</b>(<i>cToken, msg.sender</i>)</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return the collected answers of whether the user is currently in the passed cTokens</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Exit Market(<span style=" color: #B6B6B6;">address </span>cToken) returns <span style=" color: #999;">bool</span></h2><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The sender provides an asset that they no longer wish to be included in account liquidity calculations. Since all borrowed assets <b>must </b>be included, the purpose of the function is to remove an asset from the user’s collateral list. The return value is a boolean indicating if the user is not in the market after the call.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Get sender <i>tokensHeld </i>and <i>amountOwed </i>underlying from the cToken</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if the sender has a borrow balance</p><ul id="l86"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">i.e. <span class="s17">amountOwed </span><span class="s18">≠ 0</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if the sender is not permitted to redeem all of their tokens</p><ul id="l87"><li data-list-text="○"><p class="s17" style="padding-top: 4pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">i.e. </span>invoke redeemAllowed<span class="s18">(</span>cToken<span class="s18">, </span>msg<span class="s18">.</span>sender<span class="s18">, </span>tokensHeld<span class="s18">) =/ 0</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return true if the sender is not already ‘in’ the market</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set <i>cToken </i>account membership to false</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Delete <i>cToken </i>from the account’s list of assets</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>MarketExited</b>(<i>cToken, msg.sender</i>)</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return true, indicating the user is no longer in the market</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Policy Hook Functions</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">These functions are core to verifying if a given action by a user is allowed. This should be based on a combination of factors. One or more of the factors will be checked by the following functions.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l88"><li data-list-text="1."><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">cToken must be a known &quot;supported&quot; asset. <b>This applies to all functions and must always be checked.</b></p></li><li data-list-text="2."><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">User must remain sufficiently liquid after the function were to complete. For instance, a user cannot redeem tokens if she has too many outstanding borrows.</p></li><li data-list-text="3."><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">User must declare all assets she intends to borrow (and use as collateral).</p></li><li data-list-text="4."><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">User must pass all KYC-type checks and other policy rules.</p></li><li data-list-text="5."><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">For liquidation, caller must be the asset itself ( the borrowed cToken contract ).</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">mintAllowed(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>minter, <span style=" color: #B6B6B6;">uint </span>mintAmount) returns <span style=" color: #999;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>cToken </i>not listed</p></li><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 15pt;text-align: left;">*may include Policy Hook-type checks</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 20pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">mintVerify(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>minter, <span style=" color: #B6B6B6;">uint </span>mintAmount, <span style=" color: #B6B6B6;">uint </span>mintTokens) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">redeemAllowed(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>redeemer, <span style=" color: #B6B6B6;">uint </span>redeemTokens) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>cToken </i>not listed</p></li><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 15pt;text-align: left;">*may include Policy Hook-type checks</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 20pt;text-align: left;">Return <span class="s40">👍 </span>if <i>redeemer </i>does not have membership in asset</p></li><li data-list-text="●"><p class="s18" style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Let </span>(<i>error</i>, <i>liquidity</i>, <i>shortfall</i>) =</p></li></ul><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">invoke getHypotheticalAccountLiquidityInternal<span class="s18">(</span>redeemer<span class="s18">, </span>cToken<span class="s18">, </span>redeemTokens<span class="s18">, 0)</span></p><ul id="l89"><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">error </span><span class="s18">=/ 0 </span>or if <span class="s17">shortfall </span><span class="s18">&gt; 0</span></p></li></ul><ul id="l90"><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 19pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">redeemVerify(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>redeemer, <span style=" color: #B6B6B6;">uint </span>redeemAmount, <span style=" color: #B6B6B6;">uint </span>redeemTokens) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">borrowAllowed(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>borrowAmount) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail <i>if cToken not listed</i></p></li></ul><ul id="l91"><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">*may include Policy Hook-type checks</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>borrower </i>does not have membership in asset</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">oraclePrice</span><span class="s24">asset </span><span class="s18">= 0</span></p></li></ul><ul id="l92"><li data-list-text="●"><p class="s18" style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Let </span>(<i>error</i>, <i>liquidity</i>, <i>shortfall</i>) =</p></li></ul><p class="s17" style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">invoke getHypotheticalAccountLiquidityInternal<span class="s18">(</span>borrower<span class="s18">, </span>cToken<span class="s18">, 0, </span>borrowAmount<span class="s18">)</span></p><ul id="l93"><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">error </span><span class="s18">=/ 0 </span>or <span class="s17">shortfall </span><span class="s18">&gt; 0</span></p></li></ul><ul id="l94"><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 19pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">borrowVerify(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>borrowAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">repayBorrowAllowed(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>payer, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>repayAmount) returns <span style=" color: #999;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>cToken </i>not listed</p></li></ul><ul id="l95"><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 15pt;text-align: left;">*may include Policy Hook-type checks</p></li></ul><ul id="l96"><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 20pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">repayBorrowVerify(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>payer, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">uint </span>repayAmount)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">liquidateBorrowAllowed( <span style=" color: #B6B6B6;">CToken </span>cTokenBorrowed, <span style=" color: #B6B6B6;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #B6B6B6;">uint </span>repayAmount) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <i>cTokenBorrowed </i>or <i>cTokenCollateral </i>not listed</p></li><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">*may include Policy Hook-type checks</p></li><li data-list-text="●"><p class="s18" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Let </span>(<i>error</i>, <i>liquidity</i>, <i>shortfall</i>)</p></li></ul><p class="s18" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>invoke getAccountLiquidityInternal</i>(<i>borrower</i>)</p><ul id="l97"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">error </span><span class="s18">=/ 0 </span>or <span class="s17">shortfall </span><span class="s18">= 0</span></p><ul id="l98"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">The borrower must have shortfall in order to be liquidatable</p></li></ul></li></ul><ul id="l99"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">borrowBalance<span class="s24">account </span><span class="s18">= </span>call cTokenBorrowed<span class="s18">.</span>Borrow Balance Stored<span class="s18">()</span></p><ul id="l100"><li data-list-text="○"><p style="padding-top: 1pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">This value is strictly up-to-date due to accumulating interest prior to this call</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate <i>maxCloseValue</i>, the total that can be closed for this borrow:</p><ul id="l101"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">maxCloseV alue <span class="s18">=</span></p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">borrowBalance<span class="s24">account </span><span class="s28">⋅</span>closeFactor</p></li></ul></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s17">repayAmount</span></p></li></ul></li></ul></li></ul></li><li data-list-text="&gt;"><p class="s17" style="padding-top: 5pt;padding-left: 15pt;text-indent: -11pt;text-align: left;">maxCloseV alue</p><ul id="l102"><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 19pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">liquidateBorrowVerify(<span style=" color: #B6B6B6;">CToken </span>cTokenBorrowed, <span style=" color: #B6B6B6;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #B6B6B6;">uint </span>repayAmount, <span style=" color: #B6B6B6;">uint </span>seizeTokens)</h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">seizeAllowed(<span style=" color: #B6B6B6;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">CToken </span>cTokenBorrowed, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #B6B6B6;">uint </span>seizeTokens) returns <span style=" color: #999;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Fail if <span class="s41">cTokenCollateral </span>or <span class="s41">cTokenBorrowed </span>is not listed</p></li><li data-list-text="●"><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">*may include Policy Hook-type checks</p></li></ul><ul id="l103"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;line-height: 15pt;text-align: left;"><span class="p">Fail </span>call cTokenCollateral<span class="s18">.</span>comptroller<span class="s18">() =/ </span>call cTokenBorrowed<span class="s18">.</span>comptroller<span class="s18">()</span></p></li></ul><ul id="l104"><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 20pt;text-align: left;">Return <span class="s40">👍 </span>otherwise</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">seizeVerify(<span style=" color: #B6B6B6;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">CToken </span>cTokenBorrowed, <span style=" color: #B6B6B6;">address </span>borrower, <span style=" color: #B6B6B6;">address </span>liquidator, <span style=" color: #B6B6B6;">uint </span>seizeTokens)</h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">transferAllowed(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>src, <span style=" color: #B6B6B6;">address </span>dst, <span style=" color: #B6B6B6;">uint </span>transferTokens) returns <span style=" color: #999;">uint</span></h2><ul id="l105"><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>redeemAllowed<span class="s18">(</span>cToken<span class="s18">, </span>src<span class="s18">, </span>transferT okens<span class="s18">)</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">transferVerify(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">address </span>src, <span style=" color: #B6B6B6;">address </span>dst, <span style=" color: #B6B6B6;">uint </span>transferTokens)</h2><ul id="l106"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Does nothing, but could revert in the future as a defense hook</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Liquidity / Liquidation Calculations</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">getAssetsIn(<span style=" color: #B6B6B6;">address </span>account) returns <span style=" color: #B6B6B6;">address[]</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return list of assets you are in</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">checkMembership(<span style=" color: #B6B6B6;">address </span>account, <span style=" color: #B6B6B6;">CToken </span>cToken) returns <span style=" color: #B6B6B6;">bool</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Returns true if user is in asset</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">getAccountLiquidity(<span style=" color: #B6B6B6;">address </span>account) returns <span style=" color: #B6B6B6;">int</span></h2></li><li data-list-text="●"><p class="s17" style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Return </span>invoke getHypotheticalAccountLiquidity<span class="s18">(</span>account<span class="s18">, </span>CToken<span class="s18">(0), 0, 0)</span></p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">getHypotheticalAccountLiquidity( <span style=" color: #B6B6B6;">address </span>account, <span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">uint </span>redeemTokens, <span style=" color: #B6B6B6;">uint </span>borrowAmount) returns (uint, uint)</h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Let <span class="s17">assets</span><span class="s24">account </span>be the active list of assets (from storage) that a user has entered</p></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">We calculate the user’s <span class="s17">sumCollateral </span>and <span class="s17">sumBorrowPlusEffects</span></p><ul id="l107"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;line-height: 112%;text-align: left;"><span class="s42">	</span>Note that we calculate the <i>exchangeRateStored </i>for each collateral cToken using stored data, without calculating accumulated interest</p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Initialize <span class="s17">sumCollatera </span><span class="s18">= 0 </span>, <span class="s17">sumBorrowPlusEffects </span><span class="s18">= 0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -41pt;text-align: right;">For each <span class="s17">asset</span></p><ul id="l108"><li data-list-text="○"><p style="padding-top: 2pt;padding-left: 18pt;text-indent: -18pt;text-align: right;">We get:</p><p class="s28" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">∈ <span class="s17">assets</span><span class="s24">account </span><span class="p">:</span></p><ul id="l109"><li data-list-text="■"><p class="s17" style="padding-top: 2pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">cTokenBalance<span class="s24">account </span><span class="s18">= </span>call cToken<span class="s18">.</span>balanceOf <span class="s18">(</span>account<span class="s18">)</span></p><ul id="l110"><li data-list-text="■"><p class="s17" style="padding-top: 1pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">borrowBalance<span class="s24">account </span><span class="p">= </span>call cToken<span class="s18">.</span>Borrow Balance Stored<span class="s18">(</span>account<span class="s18">)</span></p></li><li data-list-text="■"><p class="s17" style="padding-top: 1pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">exchangeRate <span class="s18">= </span>call cToken<span class="s18">.</span>Exchange Rate Stored<span class="s18">()</span></p></li><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">collateralF actor <span class="s18">= </span>markets<span class="s18">[</span>asset<span class="s18">].</span>collateralF actor</p></li><li data-list-text="■"><p class="s17" style="padding-top: 3pt;padding-left: 115pt;text-indent: -20pt;text-align: left;">oraclePrice <span class="s18">= </span>call oracle<span class="s18">.</span>getUnderlyingPrice<span class="s18">(</span>asset<span class="s18">)</span></p><ul id="l111"><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 151pt;text-indent: -20pt;text-align: left;">Fail if <span class="s17">oraclePrice </span><span class="s18">= 0</span></p></li></ul></li></ul></li></ul></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">tokensToDollars <span class="s18">= </span>collateralF actor <span class="s18">· </span>exchangeRate <span class="s18">· </span>oraclePrice</p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">sumCollateral <span class="s18">+= </span>tokensToDollars <span class="s18">· </span>cTokenBalance<span class="s24">account</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 1pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">sumBorrowPlusEffects <span class="s18">+= </span>oraclePrice</p></li></ul></li></ul><ul id="l112"><li data-list-text="·"><p class="s17" style="padding-top: 1pt;padding-left: 9pt;text-indent: -6pt;text-align: left;">borrowBalance<span class="s24">account</span></p><ul id="l113"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">If </span>asset <span class="s18">= </span>cToken <span class="p">(i.e. looking at the affected market):</span></p><ul id="l114"><li data-list-text="■"><p style="padding-top: 2pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Account for the potential effect of redeeming:</p><ul id="l115"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 151pt;text-indent: -20pt;text-align: left;">sumBorrowPlusEffects <span class="s18">+= </span>tokensToDollars <span class="s18">· </span>redeemTokens</p></li></ul></li><li data-list-text="■"><p style="padding-top: 3pt;padding-left: 113pt;text-indent: -18pt;text-align: left;">Account for the potential effect of borrowing:</p><ul id="l116"><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 151pt;text-indent: -20pt;text-align: left;">sumBorrowPlusEffects</p><p class="s18" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">+= <i>oraclePrice</i></p></li></ul></li></ul></li></ul></li><li data-list-text="·"><p class="s17" style="padding-top: 2pt;padding-left: 9pt;text-indent: -6pt;text-align: left;">borrowAmount</p></li></ul><ul id="l117"><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">If</p></li></ul><p class="s17" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">sumCollateral</p></li><li data-list-text="&gt;"><p class="s17" style="padding-top: 3pt;padding-left: 19pt;text-indent: -14pt;text-align: left;">sumBorrowPlusEffects</p><ul id="l118"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">liquidity</p></li></ul></li></ul><p class="s18" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">= <i>sumCollateral</i></p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">− <i>sumBorrowPlusEffects</i></p><p class="s43" style="padding-top: 3pt;padding-left: 59pt;text-indent: 0pt;text-align: left;">○</p><ul id="l119"><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Else</p><p class="s43" style="padding-top: 2pt;padding-left: 59pt;text-indent: 0pt;text-align: left;">○</p><p class="s17" style="padding-top: 3pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">shortfall <span class="s18">= 0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 10pt;text-indent: 0pt;text-align: left;">liquidity <span class="s18">= 0</span></p><ul id="l120"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">shortfall</p><p class="s18" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">= <i>sumBorrowPlusEffects</i></p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">− <i>sumCollateral</i></p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return two unsigned values,</p><p class="s17" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">liquidity</p><p style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">and <span class="s17">shortfall</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">liquidateCalculateSeizeTokens( <span style=" color: #B6B6B6;">CToken </span>cTokenBorrowed, <span style=" color: #B6B6B6;">CToken </span>cTokenCollateral, <span style=" color: #B6B6B6;">uint </span>repayAmount) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Read oracle prices for borrowed and collateral markets:</p><ul id="l121"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">price<span class="s24">borrowed </span><span class="s18">= </span>call oracle<span class="s18">.</span>getUnderlyingPrice<span class="s18">(</span>cTokenBorrowed<span class="s18">)</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 1pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">price<span class="s24">collateral </span><span class="s18">= </span>call oracle<span class="s18">.</span>getUnderlyingPrice<span class="s18">(</span>cTokenCollateral<span class="s18">)</span></p></li><li data-list-text="○"><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -18pt;text-align: left;">Fail if either <span class="s17">price</span><span class="s24">borrowed </span><span class="s18">= 0 </span>or <span class="s17">price</span><span class="s24">collateral </span><span class="s18">= 0</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Get the exchange rate and calculate the number of collateral tokens to seize:</p><p class="s18" style="text-indent: 0pt;line-height: 14pt;text-align: left;">×</p><p style="text-indent: 0pt;text-align: left;"/><ul id="l122"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;line-height: 17pt;text-align: left;">exchangeRate<span class="s24">collateral </span><span class="s18">= </span>call cTokenCollateral<span class="s18">.</span>Exchange Rate Stored<span class="s18">()</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">seizeAmount</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>repayAmount </i>× <i>liquidationIncentive</i><span class="s32">stored</span></p><p class="s46" style="padding-left: 13pt;text-indent: 0pt;text-align: left;"><span class="s44">price</span><u>borrowed</u> <span class="s47">price</span>collateral</p></li><li data-list-text="○"><p class="s17" style="padding-top: 1pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">seizeT okens</p><p class="s18" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>seizeAmount </i>÷ <i>exchangeRate</i><span class="s24">collateral</span></p></li></ul></li><li data-list-text="●"><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Return <span class="s17">seizeT okens</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Comptroller Admin Functions</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">constructor()</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set admin to caller</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setPendingAdmin(<span style=" color: #999;">address </span>newPendingAdmin) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is admin</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store pendingAdmin with value newPendingAdmin</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingAdmin</b>(oldPendingAdmin, newPendingAdmin)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_acceptAdmin() returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is pendingAdmin and pendingAdmin ≠ address(0)</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store admin with value pendingAdmin</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Unset pendingAdmin</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewAdmin</b><i>(oldAdmin, newAdmin)</i></p></li></ul><ul id="l123"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingAdmin</b><i>(oldPendingAdmin, 0)</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setPriceOracle(<span style=" color: #B6B6B6;">address </span>newOracle)</h2><ul id="l124"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin </i>OR caller is <i>currentImplementation </i>and origin is <i>admin</i></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>invoke newOracle<span class="s18">.</span>isPriceOracle<span class="s18">() </span><span class="p">returns true</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set the comptroller&#39;s oracle to <i>newOracle</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPriceOracle</b>(<i>oldOracle</i>, <i>newOracle</i>)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setLiquidationIncentive(<span style=" color: #B6B6B6;">scaled </span>newIncentive)</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin </i>OR caller is <i>currentImplementation </i>and origin is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check de-scaled 1 ≤ <i>newLiquidationDiscount </i>≤ 1.5</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set liquidation incentive to <i>newIncentive</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewLiquidationIncentive</b>(oldIncentive, newIncentive)</p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">_setCollateralFactor(<span style=" color: #B6B6B6;">CToken </span>cToken, <span style=" color: #B6B6B6;">scaled </span>newFactor) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin </i>OR caller is <i>currentImplementation </i>and origin is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify market is listed</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <i>newFactor </i>≤ 0.9</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">If </span><span class="s14">newFactor </span><span class="p">&gt; 0, fail if </span>oracle<span class="s18">.</span>getUnderlyingPrice<span class="s18">(</span>cToken<span class="s18">)≠0</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set market&#39;s collateral factor to <i>newFactor</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewCollateralFactor</b>(<i>cToken</i>, <i>oldFactor</i>, <i>newFactor)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setCloseFactor(<span style=" color: #B6B6B6;">scaled </span>newCloseFactor) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin </i>OR caller is <i>currentImplementation </i>and origin is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check 0.05 &lt; <i>newCloseFactor </i>≤ 0.9</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set close factor to <i>newCloseFactor</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewCloseFactor</b>(old<i>CloseFactor</i>, <i>newCloseFactor)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_setMaxAssets(<span style=" color: #B6B6B6;">uint </span>newMaxAssets) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is <i>admin </i>OR caller is <i>currentImplementation </i>and origin is <i>admin</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set maxAssets to <i>newMaxAssets</i></p></li></ul><ul id="l125"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewMaxAssets</b><i>(oldMaxAssets, newMaxAssets)</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_supportMarket(<span style=" color: #B6B6B6;">CToken </span>cToken) returns <span style=" color: #B6B6B6;">uint</span></h2><ul id="l126"><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is admin</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Verify asset is not isListed</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call cToken<span class="s18">.</span>isCToken<span class="s18">() </span><span class="p">returns true</span></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Set market is listed to true</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Append cToken to <i>markets </i>list.</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>MarketListed</b>(cToken)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Implementation Upgrade Functions</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;"><a href="https://blog.zeppelinos.org/proxy-patterns/" style=" color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 13pt;" target="_blank">The comptroller is designed as an upgradeable proxy inspired by patterns described by </a><span style=" color: #1154CC; font-family:Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 13pt;">zeppelinOS</span>. In short, the pattern is</p><ol id="l127"><li data-list-text="1."><p style="padding-left: 41pt;text-indent: -18pt;text-align: left;">Deploy new implementation</p></li><li data-list-text="2."><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call comptroller<span class="s18">._</span>setP endingImplementation<span class="s18">(</span>newImplementation<span class="s18">)</span></p></li><li data-list-text="3."><p class="s17" style="padding-top: 2pt;padding-left: 43pt;text-indent: -20pt;text-align: left;">call newImplementation<span class="s18">.</span>becomeBrains<span class="s18">(</span>comptroller<span class="s18">, ...)</span></p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">_setPendingImplementation(<span style=" color: #B6B6B6;">address </span>newPendingImplementation) returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is admin</p></li><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <i>pendingComptrollerImplementation </i>with value <i>newPendingImplementation</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingImplementation</b>(<i>oldPendingAdminImplementation</i>,</p><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">newPendingImplementation<span class="p">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_acceptImplementation() returns <span style=" color: #B6B6B6;">uint</span></h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check <i>caller </i>is <i>pendingComptrollerImplementation </i>and</p><p class="s14" style="padding-top: 2pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">pendingComptrollerImplementation <span class="p">≠ </span>address(0)</p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Store <i>comptrollerImplementation </i>with value <i>pendingComptrollerImplementation</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Unset <i>pendingComptrollerImplementation</i></p></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewImplementation</b><i>(oldImplementation, newImplementation)</i></p></li></ul><ul id="l128"><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Emit <b>NewPendingImplementation</b><i>(oldPendingImplementation, 0)</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Note: _becomeBrains is called on the implementation address, where the other functions are all called on the active comptroller.</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">_becomeBrains(<span style=" color: #B6B6B6;">address </span>unitroller, <span style=" color: #B6B6B6;">address </span>oracle, <span style=" color: #999;">uint </span>closeFactor, <span style=" color: #999;">uint </span>maxAssets) returns <span style=" color: #B6B6B6;">uint</span></h2><ul id="l129"><li data-list-text="●"><p style="padding-top: 4pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Check caller is admin of unitroller</p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call unitroller<span class="s18">._</span>acceptImplementation<span class="s18">() </span><span class="p">returns true</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call unitroller<span class="s18">._</span>setMarketP riceOracle<span class="s18">(</span>oracle<span class="s18">) </span><span class="p">= 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call unitroller<span class="s18">._</span>setCloseF actor<span class="s18">(</span>closeF actor<span class="s18">) = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call unitroller<span class="s18">._</span>setMaxAssets<span class="s18">(</span>maxAssets<span class="s18">) = 0</span></p></li><li data-list-text="●"><p class="s17" style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">Ensure </span>call unitroller<span class="s18">._</span>setLiquidationIncentive<span class="s18">(</span>liquidationIncentiveMinMantissa<span class="s18">) = 0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Maximillion Contract</p><p style="padding-top: 10pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">For cErc20 contracts, we support repaying a borrow fully using the special ‘-1’ amount. Since the CToken contract is approved to transfer what it needs, it can determine the borrow amount and then transfer the exact amount, post-interest accrual, directly within the repayBorrow function.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">For cEther, things work a bit differently. Since ‘-1’ is actually UINT_MAX, it’s practically impossible for anyone to transfer this amount to the repay function. In order to completely repay a borrow in cEther, we deploy a separate contract to handle the details of collecting more than enough Ether to repay the borrow plus recent interest, and then refunding the overpay amount.</p><h2 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Repay Behalf(<span style=" color: #B6B6B6;">address </span>borrower) payable</h2></li><li data-list-text="●"><p style="padding-top: 6pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Remember the amount of Ether received:</p><ul id="l130"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">received <span class="s18">= </span>msg<span class="s18">.</span>value</p></li></ul></li><li data-list-text="●"><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Read the current borrow balance with interest accrued:</p><ul id="l131"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">borrows <span class="s18">= </span>invoke cEther<span class="s18">.</span>borrowBalanceCurrent<span class="s18">(</span>borrower<span class="s18">)</span></p></li></ul></li><li data-list-text="●"><p class="s17" style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;"><span class="p">If </span>received <span class="s18">&gt; </span>borrows <span class="p">, repay the exact borrow balance and refund:</span></p><ul id="l132"><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">invoke cEther<span class="s18">.</span>repayBorrowBehalf <span class="s18">.</span>value<span class="s18">(</span>borrows<span class="s18">)(</span>borrower<span class="s18">)</span></p></li><li data-list-text="○"><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: -18pt;text-align: left;"><span class="p">Refund </span>received <span class="s18">− </span>borrows</p></li></ul></li><li data-list-text="●"><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Otherwise, just repay the amount of Ether provided:</p><ul id="l133"><li data-list-text="○"><p class="s17" style="padding-top: 2pt;padding-left: 79pt;text-indent: -20pt;text-align: left;">invoke cEther<span class="s18">.</span>repayBorrowBehalf <span class="s18">.</span>value<span class="s18">(</span>received<span class="s18">)(</span>borrower<span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s4" style="padding-top: 12pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Appendix</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Market States</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">A given asset may be in one of four states, which affect which functions are available and how the asset is utilized above.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">Unsupported - An asset is not part of the “listedAssets” set. It is not used when calculating sumCollateral and all operations, aside of “supportMarket” for that asset should fail.</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">Listed - An asset is part of the “listedAssets” set. It is not used when calculating sumCollateral and only “supply”, “withdraw” and “repayBorrow” operations on that asset should functional normally. The asset must have an interest rate model associated with it.</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">Borrow - An asset is part of the “listedAssets” set. It is not used when calculating sumCollateral and all operations on that asset should functional normally. The asset must have a non-zero price and interest rate model associated with it. A listed market with non-zero price allows that market to be borrowed from.</p></li><li data-list-text="●"><p style="padding-left: 41pt;text-indent: -18pt;line-height: 112%;text-align: left;">Collateral - An asset is part of the “listedAssets” set. It is used when calculating sumCollateral and all operations on that asset should functional normally. The asset must have a non-zero price, non-zero collateral factor and interest rate model associated with it. A borrow market with a non-zero collateral factor is both borrowable and can be used as collateral.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="p">Regarding membership, </span>listed <span class="s28">⊆ </span>borrow <span class="s28">⊆ </span>collateral</p><p style="padding-top: 5pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">and <span class="s18">(</span><span class="s17">listed</span></p><p class="s28" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">⋂ <span class="s17">unsupported</span><span class="s18">) = </span>⊘</p><p class="s17" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="p">Regarding available functionality, </span>listed <span class="s28">⊇ </span>borrow <span class="s28">⊇ </span>collateral <span class="p">and </span>unsupported <span class="s18">=  </span><span class="s28">⊘</span></p><h1 style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Interest Index Calculation</h1><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The interest index tracks the interest owed on $1 (or some constant initial amount) of debt since the protocol’s deployment. That is, the interest on a fixed amount of the borrowed asset over time.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">Whenever the interest rate changes, the index applies the simple interest formula, to snapshot the effect of the prior interest rate since that time:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 165pt;text-indent: 0pt;text-align: left;">index<span class="s48">0</span><span class="s18"> = </span>c<span class="s18">, </span>c <span class="s18">&gt; 0</span></p><p class="s17" style="padding-top: 2pt;padding-left: 134pt;text-indent: 0pt;text-align: left;">index<span class="s24">i</span><span class="s26">+</span><span class="s49">△</span><span class="s39">blocks </span><span class="s18">= </span>index<span class="s24">i</span><span class="s28">⋅ </span><span class="s18">(1 + </span><span class="s28">△</span>blocks <span class="s18">× </span>rate<span class="s24">i </span><span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">Whenever the index is updated, we also update the total borrow (and reserves) amount, to capture the effect on all the currently borrowed (reserved) units of the asset since the last update:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 3pt;padding-left: 116pt;text-indent: 0pt;text-align: left;">borrows<span class="s24">i</span><span class="s26">+</span><span class="s49">△</span><span class="s39">blocks </span><span class="s18">= </span>borrows<span class="s24">i </span><span class="s28">⋅ </span><span class="s18">(1 + </span><span class="s28">△</span>blocks <span class="s18">× </span>rate<span class="s24">i </span><span class="s18">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">The total borrow amount is used to manage the market’s ledger, and is updated often to maintain accurate current information. On the other hand, each individual borrow is only updated when an action related to that specific borrow is taken.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">When a borrow is created, we store with it the principal amount and the interest index at that time. Whenever an action which affects the principal of the borrow is initiated, we first calculate a new principal, based on the interest that has accumulated since the last event.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 112%;text-align: left;">In order to determine how much interest has accumulated, we take the current index value and compare it to the interest index at the time of the last event which was stored in the borrow balance. The ratio of these values yields the change in $1 of debt since the principal was last recorded, for which we then calculate a new principal amount to store with the new index.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="p">The ratio </span>borrowIndex<span class="s24">i</span><span class="s26">+</span><span class="s39">b</span><span class="s18">/</span>borrowIndex<span class="s24">i </span><span class="p">is the simple interest rate over the period, which we</span></p><p style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">apply for the whole period in order to accrue interest on the principal:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">ef fectiveRate <span class="s18">= </span>borrowIndex<span class="s24">i</span><span class="s26">+</span><span class="s49">△</span><span class="s39">blocks </span><span class="s18">/ </span>borrowIndex<span class="s24">i</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">principal<span class="s24">i</span><span class="s26">+</span><span class="s49">△</span><span class="s39">blocks </span><span class="s18">= </span>principal<span class="s24">i </span><span class="s28">⋅ </span><span class="s18">(1</span></p><p class="s28" style="padding-left: 4pt;text-indent: 0pt;text-align: left;"><span class="s18">+ </span>△<span class="s17">blocks </span>⋅ <span class="s17">ef fectiveRate</span><span class="s18">) + ∆</span></p><p class="s17" style="padding-top: 3pt;padding-left: 59pt;text-indent: 0pt;text-align: left;">borrowIndex<span class="s24">i</span><span class="s26">+</span><span class="s49">△</span><span class="s39">blocks </span><span class="s18">= </span>borrowIndex<span class="s24">i</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-left: 5pt;text-indent: 0pt;line-height: 121%;text-align: left;">Mint / Redeem exchange rate remains the same when minting and redeeming coins</h1><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Let</p><p class="s17" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">A <span class="s18">= </span>assets</p><p class="s18" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>cash</i></p><p class="s18" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">+ <i>borrows held by the protocol</i></p><p class="s17" style="padding-top: 3pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">L <span class="s18">= </span>liabilities <span class="s18">= </span>tokens minted and not redeemed</p><p class="s17" style="padding-top: 3pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">dA <span class="s18">=</span></p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">change in assets</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>cash supplied</i>|<i>withdrawn or borrows sent</i>|<i>repaid</i></p><p class="s17" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">dL <span class="s18">=</span></p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">change in liabilities</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>tokens to mint</i>|<i>redeem</i></p><p class="s17" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">R <span class="s18">= </span>exchange rate <span class="s18">= </span>A <span class="s18">/ </span>L</p><p class="s17" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">A<span class="s50">′ </span><span class="s51">=</span></p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">next assets</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>A </i>+ <i>dA</i></p><p class="s17" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">L<span class="s50">′ </span><span class="s51">=</span></p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">next liabilities</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>L </i>+ <i>dL</i></p><p class="s17" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">R<span class="s50">′ </span><span class="s51">=</span></p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">next exchange rate</p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;"><span class="s18">= </span>A<span class="s50">′ </span><span class="s51">/ </span>L<span class="s50">′</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Prove that <span class="s17">R</span><span class="s50">′ </span><span class="s51">=</span></p><p class="s17" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">R <span class="p">, whenever there is a change in </span>dA <span class="p">, where </span>dA <span class="s18">/ </span>dL <span class="s18">= </span>R</p><p class="s18" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">= <i>A </i>/ <i>L </i><span class="p">.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">dL <span class="s18">=</span></p><p class="s17" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA <span class="s18">/ </span>R <span class="s18">=</span></p><p class="s17" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">L <span class="s52">* </span>dA <span class="s18">/ </span>A</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">R<span class="s50">′ </span><span class="s51">= </span>A<span class="s50">′ </span><span class="s51">/ </span>L<span class="s50">′</span></p><p class="s18" style="padding-top: 3pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">= (<i>A </i>+</p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / (</span>L</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">+ <i>dL</i>)</p><p class="s18" style="padding-top: 3pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">= (<i>A </i>+</p><p class="s18" style="padding-top: 3pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">= (<i>A </i>+</p><p class="s17" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / (</span>L</p><p class="s17" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / (</span>L</p><p class="s18" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">+ <i>L</i></p><p class="s52" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">* <span class="s18">(1</span></p><p class="s17" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;"><span class="s52">* </span>dA <span class="s18">/ </span>A<span class="s18">)</span></p><p class="s18" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">+ <i>dA </i>/ <i>A</i>))</p><p class="s18" style="padding-top: 1pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">= (<i>A </i>+</p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / (</span>L <span class="s52">*</span></p><p class="s18" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">(<i>A </i>/ <i>A </i>+</p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA <span class="s18">/ </span>A<span class="s18">))</span></p><p class="s18" style="padding-top: 1pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">= (<i>A </i>+</p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / (</span>L <span class="s52">*</span></p><p class="s18" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">(<i>A </i>+</p><p class="s17" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">dA<span class="s18">) / </span>A<span class="s18">)</span></p><p class="s18" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">=</p><p class="s18" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">=</p><p class="s18" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">=</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">q.e.d.</p><p class="s18" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;line-height: 125%;text-align: left;">1 / <i>L </i>/ <i>A A </i>/ <i>L</i></p><p class="s17" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">R</p></body></html>
